<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../sa-login/sa-login-signin.html" />
<link rel="import" href="../sa-login/sa-login-signup.html" />

<dom-module id="sa-drawer">
    <style>
        :host {
            display:flex;
            flex-direction:column;
            align-items:center;
            background-color:#2b2b2b;
            height:100%;
            overflow:hidden;

            --paper-tab:{
                padding:0;
                text-transform:uppercase;
                color:#a6a6a6;
            }
            --paper-tabs:{
                height:40px;
                width:90%;
                padding:3px 0 0;
                background-color:#363636;
            }
            --paper-tabs-selection-bar:{
                height:0px;
            }
            --paper-tab-content-unselected:{
                background-color:#363636;
            }
            --paper-tab-content:{
                background-color:#2b2b2b;
                border-top-left-radius:5px;
                border-top-right-radius:5px;
            }
        }

        .not-logged-container{            
            display:flex;
            flex-direction:column;
            height:100%;
        }

        #avatar-container{
            width:100%;
            flex-grow:1;
            background-image:url('../../images/gradient-2_300x300.png');
            background-repeat:no-repeat;
            display:flex;
            justify-content:center;
            align-items:center;
        }

        #avatar{            
            width:155px;
            height:155px;
            background-repeat:no-repeat;
            border-radius:50%;
        }

        .footer{
            display:flex;
            flex-direction:column;
            align-items:center;
        }

        #toggle-button{
            text-transform:none;
            background-color:#9b2531;
            width:85%;
            border-radius:5px;
        }
        
        .content{
            width:100%;
            background-color:#2b2b2b;            
            flex-grow:62;
            display:flex;
            justify-content:center;
        }

        .signin{
            margin:auto;
        }

        iron-collapse{
            width:100%;
        }

        .dummy{
            height:56.4vh;
        }
        
        .dummy2{
            height:28vh;
        }

        #signin-collapse{
            display:flex;
            flex-direction:column;
            justify-content:space-between;
        }

        .is-logged{
            display:flex;
            flex-direction:column;
            justify-content:space-between;
            align-items:center;
            width:100%;
            background-color:#363636;          
        }

        #sing-out-button{
            text-transform:none;
            background-color:#472a2e;
            width:99%;
            border-radius:0px;
            color:#cccccc;
        }

        iron-pages{
            display:flex;
            justify-content:center;
            width:100%;
        }

        .tab{
            background-color:#2b2b2b;
            flex-grow:1;
            padding: 5px;
        }

        #role{
            flex-grow:2;
        }

        .slice{
            background-color:#363636;
            margin-top:2px;
            height:35px;
            color:#727272;
            padding: 0 5px;
            display:flex;
            align-items:center;
            cursor:pointer;
        }

        .first-slice{
            border-top-left-radius:5px;
            border-top-right-radius:5px;
        }

        .last-slice{
            border-bottom-left-radius:5px;
            border-bottom-right-radius:5px;
        }

        .id{
            width:100%;
            display:flex;
            justify-content:center;
            color:#454545;
            margin:7px;
        }

    </style>

    <template>
            <div id="avatar-container">
                <div id="avatar"></div>
            </div>
            <div class="content">
                <iron-pages id="drawer-page" selected="[[isLogged]]">

                    <div class="not-logged-container">
                        <iron-collapse id="signin-collapse">
                            <div class="signin">
                                <sa-login-signin user="{{user}}"></sa-login-signin>
                                <div class="dummy"><span>&nbsp;</span></div>
                            </div>
                        </iron-collapse>
                        <div class="footer">
                            <paper-button id="toggle-button" on-tap="_toggleView">Sign Up</paper-button>
                            <iron-collapse id="signup-collapse" on-transition-end="_openSignIn">
                                <div class="signin">
                                    <sa-login-signup user="{{user}}"></sa-login-signup>
                                </div>
                                <div class="dummy2"><span>&nbsp;</span></div>
                            </iron-collapse>
                        </div>
                    </div>
                    <div class="is-logged">
                        <paper-tabs noink selected="{{role}}" attr-for-selected="data-role" on-iron-select="_onRoleChanged">
                            <paper-tab data-role="agent">Agent</paper-tab>
                            <paper-tab data-role="sponsor">Sponsor</paper-tab>
                        </paper-tabs>
                        <iron-pages id="role" selected="{{role}}" attr-for-selected="data-role">
                            <div id="agent-tab" class="tab" data-role="agent">
                                <div class="id"><span>Agent:&nbsp;</span><span>[[user.agentID]]</span></div>
                                <div class="slice first-slice" on-click="goToAgentMessages">Messages</div>
                                <div class="slice">Missions Accepted</div>
                                <div class="slice">Missions Done</div>
                                <div class="slice last-slice">Upcoming RDV</div>
                            </div>
                            <div id="sponsor-tab" class="tab" data-role="sponsor">
                                <div class="id"><span>Sponsor:&nbsp;</span><span>[[user.agentID]]</span></div>
                                <div class="slice first-slice" on-click="goToSponsorMessages">Messages</div>
                                <div class="slice">Missions Draft</div>
                                <div class="slice">Missions Post</div>
                                <div class="slice">Missions Ended</div>
                                <div class="slice last-slice">Upcoming RDV</div>
                            </div>
                        </iron-pages>

                        <paper-button id="sing-out-button" on-tap="_logOut">Log Out</paper-button>
                    </div>

                </iron-pages>
            </div>
    </template>

    <script>
        (function () {
            Polymer({
                is: 'sa-drawer',

                properties: {
                    isLogged: Boolean,
                    tabSelected: {
                        type: Number,
                        value:0
                    },
                    user: {
                        type: Object,
                        observer: '_userChanged'
                    },
                    role: {
                        type: String,
                        value: 'agent'
                    }
                },
                ready: function () {
                    this._userChanged(null);
                    this.$$('#signin-collapse').show();
                    this.$$('#signup-collapse').hide();

                },
                _onSignup:function(e){
                    this.querySelector('sa-login-signin').signin({
                        email: e.detail.email,
                        password: e.detail.password
                    });
                },
                _computeSelectedPage: function () {
                    if (app.isLogged) {
                        return "profile";
                    }
                    else {
                        return "not-logged";
                    }
                },
                _userChanged: function (e) {
                    if (this.user)
                        this.$.avatar.style.background = this.user.avatar;
                    else
                        this.$.avatar.style.background = "url('../../images/default_avatar.png')";
                },
                _toggleView: function (e) {
                    if (this.$$('#signin-collapse').opened) {
                        this.$$('#signin-collapse').hide();
                        this.$$('#signup-collapse').show();
                    }
                    else {
                        this.$$('#signup-collapse').hide();
                    }
                },
                _openSignIn: function (e) {
                    if (!this.$$('#signup-collapse').opened) {
                        this.$$('#signin-collapse').show();
                    }
                },
                _logOut: function (e) {
                    clearToken();
                    app.onLogOut();
                    this._userChanged(null);
                },
                goToAgentMessages: function (e) {
                    app.route = 'messages';
                },
                goToSponsorMessages: function (e) {
                    app.route = 'messages';
                },
                _onRoleChanged: function (e) {
                    app.role = this.role;
                    app.fire('role-changed');
                }
            });
        })();
    </script>
</dom-module>
