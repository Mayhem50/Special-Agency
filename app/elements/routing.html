<script src="../../bower_components/page/page.js"></script>
<script>
    window.addEventListener('WebComponentsReady', function () {
        page('/', function () {
            app.route = isAuthenticated('home');
        });

        page('/login', function () {
            app.route = 'login';
        });

        page('/logout', function () {
            var token = getToken();
            if (token !== '' || token === 'undefined') {
                clearToken();
                var xhttp = new XMLHttpRequest();
                xhttp.open("POST", "https://127.0.0.1:3000/logout", true);
                xhttp.send();
                document.querySelector('#deconnexionToggle').hide();
                app.onMenuSelect();
                app.route = 'login';
                window.history.go(0);
            }            
        });

        page('/profile/:name', function (data) {
            app.route = isAuthenticated('profile');
            app.params = data.params;
        });

        page('/users', function () {
            app.route = 'users';
        });

        page('/users/:name', function (data) {
            app.route = 'user-info';
            app.params = data.params;
        });

        page('/contact', function () {
            app.route = 'contact';
        });

        // add #! before urls
        page({
            hashbang: true
        });

        function isAuthenticated(route) {
            var token = getToken();

            if (token == '' || typeof token == "undefined")
                return 'login';
            else {
                document.querySelector('#deconnexionToggle').show();
                return route;
            }
        }

        function getToken() {
            if (window.localStorage['remember'] == "true") {
                return window.localStorage.token;
            }
            else {
                return window.sessionStorage.token;
            }
        }

        function clearToken() {
            if (window.localStorage['remember'] == "true") {
                window.localStorage.token = '';
            }
            else {
                window.sessionStorage.token = '';
            }
        }
    });
</script>
