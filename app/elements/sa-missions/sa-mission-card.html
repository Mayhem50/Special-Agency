<link rel="import" href="../../../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../sa-dates/sa-dates.html" />
<link rel="import" href="../sa-translations/sa-translation.html" />

<dom-module id="sa-mission-card">
    <style>
        :host {
            color: #feffff;
        }

        paper-card {
            align-self: center;
            border-radius: 7px;
            cursor: pointer;
            margin: 5px;
            min-width: 300px;
            max-width: 300px;
            @apply(--sa-mission-card);
        }

        .header {
            height: 300px;
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
            background-color: rgba(4, 4, 4, 0.23);
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .gain {
            height: 100px;
            background-color: rgba(76, 255, 0, 0.00);
            font-size: 20px;
            font-family: 'Segoe UI Symbol';
            color: rgba(255, 255, 255, 0.85);
            margin: 5px auto auto 5px;
        }

        .reward {
            font-size: 70px;
            margin: 5px auto auto 25px;
            font-family: 'Segoe WP SemiLight';
            font-weight: 100;
            color: #ffffff;
        }

        .dates {
            bottom: 10px;
            background-color: rgba(0, 255, 144, 0.00);
            align-self: flex-end;
            width:100%;
        }

        .title {
            font-size: 24px;
            text-align: right;
            margin-bottom: 15px;
            margin-right: 15px;
        }

        .command {
            display: flex;
            justify-content: flex-end;
        }

            .command > paper-icon-button {
                width: 30px;
            }

        .middle {
            height: 175px;
            background-color: #ffffff;
            flex-direction: column;
            display: flex;
        }

        .footer {
            height: 42px;
            background-color: #efefef;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
            cursor:default;
        }

        paper-button {
            text-transform: none;
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #999999;
            padding:0 0.57em;
        }

            paper-button iron-icon {
                margin-right: 5px;
                width: 18px;
            }

        #description {
            color: #b3b3b3;
            margin:0 15px;
            font-size:14px;
        }

        #title {
            color: #676767;
            margin-top:40px;
            font-size:18px;
        }

        #level-part {
            display: flex;
            flex-direction: column;
            width:64px;
        }

        #level {
            padding: 2px 10px;
            font-size: 12px;
            text-align: center;
        }

        #level-image {
            height: 30px;
        }

        #middle-row1{
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
        }
    </style>

    <template>

        <paper-card id="[[cardName]]" on-mouseenter="_mouseOver" on-mouseleave="_mouseOut">
            <div class="header">
                <div class="gain">
                    <div>[[_translations.texts.earn_up_to]]</div>
                    <div class="reward"><span>[[mission.reward]]</span><span>€</span></div>
                </div>
                <div id="command" class="command">
                    <paper-icon-button icon="delete" on-tap="_deleteMission"></paper-icon-button>
                    <paper-icon-button icon="create" on-tap="_editMission"></paper-icon-button>
                </div>
                <div class="dates">
                    <sa-dates dates="[[mission.wishDates]]" limit="5"></sa-dates>
                </div>
            </div>

            <div id="[[middle]]" class="middle">
                <div id="middle-row1">
                    <div id="title">Painting Walls<!--[[mission._subType.name.en]]--></div>
                    <div id="level-part">
                        <div id="level">[[levelLabel]]</div>
                        <iron-collapse id="image-collapse">
                            <div id="level-background">
                                <div id="level-image"></div>
                            </div>
                        </iron-collapse>
                    </div>
                </div>
                <div id="description">lorem ipsum dolor sit amet consectetur adipiscing elit. aliquam rutrum fringilla dui viverra semper<!--[[mission.shortDescription]]--></div>
            </div>

            <div id="[[footer]]" class="footer ">
                <paper-button on-tap="_addToFavorites"><iron-icon icon="favorite"></iron-icon><span>[[_translations.texts.add_to_favorites]]</span></paper-button>
                <paper-button on-tap="_postulateMission"><iron-icon icon="check"></iron-icon><span>[[_translations.texts.accept]]</span></paper-button>
            </div>

        </paper-card>

        <sa-translation id="translations"
                        element="sa-mission-card"
                        translations="{{_translations}}"></sa-translation>

    </template>

    <script>
        (function () {
            Polymer({
                is: 'sa-mission-card',

                properties: {
                    mission: {
                        type: Object,
                        observer: 'init'
                    },
                    index: Number,
                    levelLabel: String,
                    _translations: {
                        type: Object,
                        observer: 'init'
                    },
                    showLevel: {
                        type: Boolean,
                        value: false
                    },
                    acceptEvent: {
                        type: Boolean,
                        value: false
                    },
                    hide: {
                        type: Boolean,
                        value: true
                    },
                },
                ready: function () {
                },
                attached:function(){
                    this.init();
                },
                handleChange: function (e) {
                    this.init();
                },
                init: function () {
                    if (this.hide) {
                        this.$.command.style.display = 'none';
                    }
                    else {
                        this.$.command.style.display = 'flex';
                    }

                    if (!this.mission || !this.mission._type) { return; }

                    this.cardName = 'card-mission-' + this.mission._type.css + '-' + this.index;
                    this.middle = this.cardName + '-middle';
                    this.footer = this.cardName + '-footer';

                    var id = '#' + this.cardName;

                    this.$$(id).style.backgroundImage = 'url(/images/kinds/' + this.mission._type.image.path + ')';
                    this.$$(id).style.backgroundPosition = this.mission._type.image.xOffset + ' ' + this.mission._type.image.yOffset;
                    this.$$(id).style.backgroundSize = this.mission._type.image.size;                    

                    this._computeLevel();
                    this.$$('sa-dates').refresh();

                    if (this.showLevel) {
                        this.$$('#image-collapse').show();
                    }
                    else {
                        this.$$('#image-collapse').hide();
                    }
                },
                _deleteMission: function (e) {
                    this.fire('delete-mission', { mission: this.mission });
                },
                _editMission: function (e) {
                    this.fire('edit-mission', { mission: this.mission });
                },
                _computeLevel: function (level) {
                    var image;
                    switch (this.mission.level) {
                        default:
                        case 0:
                            image = 'easy';
                            break;
                        case 1:
                            image = 'simple';
                            break;
                        case 2:
                            image = 'normal';
                            break;
                        case 3:
                            image = 'advanced';
                            break;
                        case 4:
                            image = 'difficult';
                            break;
                    }
                    this.$$('#level-image').style.backgroundImage = 'url("/images/levels/' + image + '.png")';
                    this.$$('#level-background').style.background = this.mission._type.color;
                    this.$$('#level-image').style.border = '1px solid ' + this.mission._type.color;
                    this.$.level.style.background = this.mission._type.color;
                    if (this._translations)
                        this.levelLabel = this._translations.texts[image];
                },
                _mouseOver: function (e) {
                    if (!this.acceptEvent) { return; }

                    var div = this.querySelector('paper-card');
                    if (!div) { return; }

                    div.elevation = 5;
                    this.$$('#image-collapse').show();
                },
                _mouseOut: function (e) {
                    if (!this.acceptEvent) { return; }

                    var div = this.querySelector('paper-card');
                    if (!div) { return; }

                    div.elevation = 1;
                    this.$$('#image-collapse').hide();
                }
            });
        })();
    </script>
</dom-module>
