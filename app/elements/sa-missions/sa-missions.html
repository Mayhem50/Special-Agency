<dom-module id="sa-missions">
    <style>
        .missions {
            border-radius: 2px;
            padding: 16px 0 16px 0;
            width: calc(98.66% - 16px);
            margin: 16px auto;
            background: white;
        }

        .title {
            font-size: 34px;
        }

        iron-image {
            width: 25%;
            height: 25%;
        }

        .onboard {
            --iron-icon-height: 48px;
            --iron-icon-width: 48px;
        }

        paper-fab {
            background-color: #118c89;
        }

        paper-dialog {
            background-color: white;
        }

        .red .paper-header {
            background-color: #118c89;
        }

        .wizzard {
            Position: Fixed;
            Top: 0;
            Left: 0;
            Right: 0;
            Bottom: 0;
            Padding: 10px;
            Margin: 15px;
        }

        .createButton {
            position: fixed;
            bottom: 25px;
            right: 40px;
        }

        .leftButton {
            position: absolute;
            bottom: 20px;
            left: calc(98% / 2 - 60px);
        }

        .rightButton {
            position: absolute;
            bottom: 20px;
            right: calc(98% / 2 - 60px);
        }

        .type-wrapper {
            display: inline-block;
            padding: 2px;
            margin: 6px 0;
        }

            .type-wrapper.iron-selected {
                background-color: #00BCD4;
                border-radius: 50%;
            }

        .iconList {
            margin: 16px 0 8px 0;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
    </style>
    <template is="dom-bind">

        
        <div>
            <template is="dom-repeat" items="{{missions}}">
                <paper-item on-tap="showMission">
                    <paper-item-body>
                        <div>{{item.title}}</div>
                    </paper-item-body>
                </paper-item>
            </template>
        </div>
        <div>
            <paper-fab class="createButton" icon="create" on-tap="createMission"></paper-fab>
        </div>

        <paper-dialog id="missionWizzard" no-cancel-on-outside-click class="wizzard" autofitonattach="true">
            <iron-pages attr-for-selected="data-step" selected="{{step}}">

                <section data-step="1">
                    <div>First Step</div>
                    <paper-input id="title" is="title" label="Title" name="title" value="{{ajax_params.title::input}}"></paper-input>
                    <div class="iconList" flex>
                        <iron-selector attr-for-selected="mission-type" selected="{{ajax_params.type}}" layout horizontal justified wrap>
                            <div>Type</div>
                            <div class="type-wrapper" mission-type="type-A">
                                <iron-icon icon="add"></iron-icon>
                            </div>
                            <div class="type-wrapper" mission-type="type-B">
                                <iron-icon icon="add"></iron-icon>
                            </div>
                            <div class="type-wrapper" mission-type="type-C">
                                <iron-icon icon="add"></iron-icon>
                            </div>
                        </iron-selector>
                    </div>
                    <div class="iconList" flex>
                        <div>Difficulty</div>
                        <iron-selector selected="{{ajax_params.level}}" layo layout horizontal justified wrap>
                            <div class="type-wrapper">
                                <iron-icon icon="account-circle" style="color:green;"></iron-icon>
                            </div>
                            <div class="type-wrapper">
                                <iron-icon icon="account-circle" style="color:blue;"></iron-icon>
                            </div>
                            <div class="type-wrapper">
                                <iron-icon icon="account-circle" style="color:red;"></iron-icon>
                            </div>
                        </iron-selector>
                    </div>

                    <paper-input id="reward" is="reward" type="number" min="0" label="Reward" name="reward" value="{{ajax_params.reward::input}}"><div prefix>€</div></paper-input>
                    <paper-input id="location" is="location" label="Location" name="location" value="{{ajax_params.location::input}}"></paper-input>
                    <paper-input id="description" is="description" label="Description" name="description" value="{{ajax_params.description::input}}"></paper-input>

                    <div class="iconList">
                        <div class="type-wrapper">
                            <iron-icon icon="camera-enhance" style="color:blue;"></iron-icon>
                        </div>
                        <div class="type-wrapper">
                            <iron-icon icon="file-upload" style="color:blue;"></iron-icon>
                        </div>
                    </div>

                    <paper-fab icon="close" class="leftButton" on-tap="cancelMission"></paper-fab>
                    <paper-fab icon="check" class="rightButton" on-tap="addMission"></paper-fab>
                </section>

                <section data-step="2">
                    <div>Second Step</div>
                    <paper-fab icon="arrow-back" class="leftButton" on-tap="decStep"></paper-fab>
                    <paper-fab icon="arrow-forward" class="rightButton" on-tap="incStep"></paper-fab>

                </section>
                <section data-step="3">
                    <div>Third Step</div>
                    <paper-fab icon="arrow-back" class="leftButton" on-tap="decStep"></paper-fab>

                </section>
            </iron-pages>
        </paper-dialog>

        <paper-dialog id="missionDetail" no-cancel-on-outside-click class="wizzard" autofitonattach="true">
            
                <div id="title" is="title">{{mission.title}}</div>
                <div class="iconList" flex>                    
                        <div>Type</div>
                        <div class="type-wrapper">{{mission.type}}<iron-icon icon="add"></iron-icon></div>
                        <div class="type-wrapper" >{{mission.owner}}<iron-icon icon="account-circle"></iron-icon></div>
                    
                </div>              

                <div id="reward" is="reward" type="number" min="0" label="Reward" name="reward" ></div>
                <div id="location" is="location" label="Location" name="location"></div>
                <div id="description" is="description" label="Description" name="description"></div>
                               
            
        </paper-dialog>

        <iron-ajax id="mission-ajax"
                   url="/missions"
                   params="{{ajax_params}}"
                   handle-as="json"
                   method="{{ajax_method}}"
                   on-response="handleResponse"
                   last-response="{{ajax_response}}">
        </iron-ajax>

    </template>

    <script>
        (function () {
            Polymer({
                is: 'sa-missions',
                properties: {
                    notification:{
                        type : Boolean,
                        notify: true,
                        observer : 'handleNotification'
                    },
                    response: {
                        type: Object
                    },
                    missions: {
                        type: Object,
                        notify: true
                    },
                    currentMission:{
                        type: Object,
                    },
                    ajax_headers: {
                        type: Object,
                    },
                    ajax_response: {
                        type: Object,
                        notify: true
                    },
                    ajax_params: {
                        type: Object,
                        value: function () {
                            return {
                                title: '',
                                type: '',
                                level: '',
                                reward: 0,
                                location: '',
                                description: '',
                                image: ''
                            }
                        }
                    },
                    ajax_method: {
                        type: String,
                    },
                    step: {
                        type: Number,
                        value: 1,
                        notify: true
                    }
                },
                ready: function () {
                    app.title = 'Missions';
                    this.ajax_headers = $.ajax.headers;
                },
                attached: function () {
                    //this.getMissions();
                },
                handleNotification: function () {
                    this.getMissions();
                },
                createMission: function () {
                    var diag = document.getElementById('missionWizzard');
                    this.step = 1;
                    diag.open();
                },
                cancelMission: function () {
                    var diag = document.getElementById('missionWizzard');
                    diag.close();
                },
                incStep: function () {
                    if (this.step == 3) {
                        return;
                    }

                    this.step += 1;
                },
                decStep: function () {
                    if (this.step == 1) {
                        return;
                    }

                    this.step -= 1;
                },
                addMission: function () {
                    this.ajax_method = 'POST';
                    this.sendRequest();

                    var diag = document.getElementById('missionWizzard');
                    diag.close();
                },
                getMissions: function () {
                    this.ajax_method = 'GET';
                    this.sendRequest();
                    return this.missions;
                },
                sendRequest: function () {
                    this.ajax_params.access_token = window.sessionStorage.token;
                    document.getElementById('mission-ajax').generateRequest();
                },
                handleResponse: function () {
                    if (this.ajax_response.success) {
                        if (this.ajax_response.method === 'POST') {
                            this.getMissions();
                        }
                        else if (this.ajax_response.method === 'GET') {
                            this.missions = this.ajax_response.missions;
                        }
                    }
                },
                showMission: function (e) {
                    this.mission = e.model.item;
                    var diag = document.getElementById('missionDetail');
                    diag.open();
                }
            });
        })();
    </script>
</dom-module>
